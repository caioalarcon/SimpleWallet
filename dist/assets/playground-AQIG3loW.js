import"./modulepreload-polyfill-B5Qt9EMX.js";const y="playgroundDefaults",a={signedReady:!1},n={pactEditor:document.getElementById("pactEditor"),btnLocal:document.getElementById("btnLocal"),localResult:document.getElementById("localResult"),btnSign:document.getElementById("btnSign"),signedPayload:document.getElementById("signedPayload"),btnSend:document.getElementById("btnSend"),sendResult:document.getElementById("sendResult"),btnListen:document.getElementById("btnListen"),btnPoll:document.getElementById("btnPoll"),txResult:document.getElementById("txResult")};function g(){try{const e=JSON.parse(localStorage.getItem(y)||"null");if(e)return e}catch{}const t={networkId:"testnet04",chainId:"1",sender:"",gasLimit:1e3,gasPrice:1e-8,ttl:28800};return localStorage.setItem(y,JSON.stringify(t)),t}let o=g();function l(t,e){const s=document.createElement("div");s.style.color="red",s.textContent=JSON.stringify(e),t.innerHTML="",t.appendChild(s)}function m(t){const e=document.createElement("div");e.className="toast",e.textContent=t,document.body.appendChild(e),setTimeout(()=>e.remove(),2e3)}async function c(t,e){const s=`https://api.testnet.chainweb.com/chainweb/0.0/${o.networkId}/chain/${o.chainId}/pact/api/v1${t}`,i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw await i.json();return await i.json()}n.btnLocal.addEventListener("click",async()=>{const t=n.pactEditor.value,e={sender:o.sender,chainId:o.chainId,gasLimit:o.gasLimit,gasPrice:o.gasPrice,ttl:o.ttl,creationTime:Math.floor(Date.now()/1e3)},s={pactCode:t,envData:{},meta:e,networkId:o.networkId};try{const i=await c("/local",s);n.localResult.textContent=JSON.stringify(i,null,2)}catch(i){l(n.localResult,i)}});n.btnSign.addEventListener("click",async()=>{const t=n.pactEditor.value,e={sender:o.sender,chainId:o.chainId,gasLimit:o.gasLimit,gasPrice:o.gasPrice,ttl:o.ttl,creationTime:Math.floor(Date.now()/1e3)},s={networkId:o.networkId,payload:{exec:{code:t,data:{}}},signers:[{pubKey:o.sender}],meta:e},i=JSON.stringify(s),r=await b(i);try{const d=await window.kadena.requestSign({pactCommand:s}),u=d&&d.sigs||d;a.cmd=i,a.hash=r,a.sigs=u,a.signedReady=!0,n.btnSend.disabled=!1,n.signedPayload.textContent=JSON.stringify({cmd:i,hash:r,sigs:u},null,2)}catch(d){(d==null?void 0:d.type)==="userCancelled"?m("Signing aborted"):l(n.signedPayload,d)}});n.btnSend.addEventListener("click",async()=>{var e;if(!a.signedReady||!a.cmd||!a.hash||!a.sigs)return;const t={cmd:a.cmd,hash:a.hash,sigs:a.sigs};try{const s=await c("/send",t);n.sendResult.textContent=JSON.stringify(s,null,2);const i=((e=s.requestKeys)==null?void 0:e[0])||s.requestKey;a.requestKey=i,n.btnListen.disabled=!i,n.btnPoll.disabled=!i}catch(s){l(n.sendResult,s)}});n.btnListen.addEventListener("click",async()=>{if(a.requestKey)try{const t=await c("/listen",{requestKey:a.requestKey});n.txResult.textContent=JSON.stringify(t,null,2)}catch(t){l(n.txResult,t)}});n.btnPoll.addEventListener("click",async()=>{if(a.requestKey){n.btnPoll.disabled=!0,n.btnPoll.classList.add("loading");try{let t=!1;for(;!t;){const e=await c("/poll",{requestKeys:[a.requestKey]});Object.keys(e).length===0||e[a.requestKey].result.status==="pending"?await new Promise(s=>setTimeout(s,3e3)):(n.txResult.textContent=JSON.stringify(e,null,2),t=!0)}}catch(t){l(n.txResult,t)}finally{n.btnPoll.classList.remove("loading"),n.btnPoll.disabled=!1}}});async function b(t){const e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));return Array.from(new Uint8Array(e)).map(s=>s.toString(16).padStart(2,"0")).join("")}
