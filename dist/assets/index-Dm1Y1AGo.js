(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const r of d)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(d){const r={};return d.integrity&&(r.integrity=d.integrity),d.referrerPolicy&&(r.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?r.credentials="include":d.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(d){if(d.ep)return;d.ep=!0;const r=t(d);fetch(d.href,r)}})();const g="playgroundDefaults",o={signedReady:!1},e={pactEditor:document.getElementById("pactEditor"),btnLocal:document.getElementById("btnLocal"),divLocalResult:document.getElementById("divLocalResult"),btnSign:document.getElementById("btnSign"),divSigned:document.getElementById("divSigned"),btnSend:document.getElementById("btnSend"),divSendResult:document.getElementById("divSendResult"),btnListen:document.getElementById("btnListen"),btnPoll:document.getElementById("btnPoll"),divTxResult:document.getElementById("divTxResult"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),saveSettings:document.getElementById("saveSettings"),cancelSettings:document.getElementById("cancelSettings"),inputNetwork:document.getElementById("setNetworkId"),inputChain:document.getElementById("setChainId"),inputSender:document.getElementById("setSender"),inputGasLimit:document.getElementById("setGasLimit"),inputGasPrice:document.getElementById("setGasPrice"),inputTTL:document.getElementById("setTtl")};function y(){try{const s=JSON.parse(localStorage.getItem(g)||"null");if(s)return s}catch{}const n={networkId:"testnet04",chainId:"1",sender:"",gasLimit:1e3,gasPrice:1e-8,ttl:28800};return localStorage.setItem(g,JSON.stringify(n)),n}let i=y();function p(){e.inputNetwork.value=i.networkId,e.inputChain.value=i.chainId,e.inputSender.value=i.sender,e.inputGasLimit.value=String(i.gasLimit),e.inputGasPrice.value=String(i.gasPrice),e.inputTTL.value=String(i.ttl),e.settingsModal.style.display="block"}function m(){e.settingsModal.style.display="none"}e.settingsBtn.addEventListener("click",p);e.cancelSettings.addEventListener("click",m);e.saveSettings.addEventListener("click",()=>{i={networkId:e.inputNetwork.value,chainId:e.inputChain.value,sender:e.inputSender.value,gasLimit:Number(e.inputGasLimit.value),gasPrice:Number(e.inputGasPrice.value),ttl:Number(e.inputTTL.value)},localStorage.setItem(g,JSON.stringify(i)),m()});function c(n,s){const t=document.createElement("div");t.style.color="red",t.textContent=JSON.stringify(s),n.innerHTML="",n.appendChild(t)}async function l(n,s){const t=`https://api.testnet.chainweb.com/chainweb/0.0/${i.networkId}/chain/${i.chainId}/pact/api/v1${n}`,a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw await a.json();return await a.json()}e.btnLocal.addEventListener("click",async()=>{const n=e.pactEditor.value,s={sender:i.sender,chainId:i.chainId,gasLimit:i.gasLimit,gasPrice:i.gasPrice,ttl:i.ttl,creationTime:Math.floor(Date.now()/1e3)},t={pactCode:n,envData:{},meta:s,networkId:i.networkId};try{const a=await l("/local",t);e.divLocalResult.textContent=JSON.stringify(a,null,2)}catch(a){c(e.divLocalResult,a)}});e.btnSign.addEventListener("click",async()=>{const n=e.pactEditor.value,s={sender:i.sender,chainId:i.chainId,gasLimit:i.gasLimit,gasPrice:i.gasPrice,ttl:i.ttl,creationTime:Math.floor(Date.now()/1e3)},t={networkId:i.networkId,payload:{exec:{code:n,data:{}}},signers:[{pubKey:i.sender}],meta:s},a=JSON.stringify(t),d=await f(a);try{const r=await window.kadena.requestSign({pactCommand:t});o.cmd=a,o.hash=d,o.sigs=r,o.signedReady=!0,e.btnSend.disabled=!1,e.divSigned.textContent=JSON.stringify({cmd:a,hash:d,sigs:r},null,2)}catch(r){(r==null?void 0:r.type)==="userCancelled"?alert("Signing aborted"):c(e.divSigned,r)}});e.btnSend.addEventListener("click",async()=>{var s;if(!o.signedReady||!o.cmd||!o.hash||!o.sigs)return;const n={cmd:o.cmd,hash:o.hash,sigs:o.sigs};try{const t=await l("/send",n);e.divSendResult.textContent=JSON.stringify(t,null,2);const a=((s=t.requestKeys)==null?void 0:s[0])||t.requestKey;o.requestKey=a,e.btnListen.disabled=!a,e.btnPoll.disabled=!a}catch(t){c(e.divSendResult,t)}});e.btnListen.addEventListener("click",async()=>{if(o.requestKey)try{const n=await l("/listen",{requestKey:o.requestKey});e.divTxResult.textContent=JSON.stringify(n,null,2)}catch(n){c(e.divTxResult,n)}});e.btnPoll.addEventListener("click",async()=>{var s;if(!o.requestKey)return;e.btnPoll.disabled=!0;const n=document.createElement("span");n.textContent="⏳",(s=e.btnPoll.parentElement)==null||s.appendChild(n);try{let t=!1;for(;!t;){const a=await l("/poll",{requestKeys:[o.requestKey]});Object.keys(a).length===0||a[o.requestKey].result.status==="pending"?await new Promise(d=>setTimeout(d,3e3)):(e.divTxResult.textContent=JSON.stringify(a,null,2),t=!0)}}catch(t){c(e.divTxResult,t)}finally{n.remove(),e.btnPoll.disabled=!1}});async function f(n){const s=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(n));return Array.from(new Uint8Array(s)).map(t=>t.toString(16).padStart(2,"0")).join("")}
