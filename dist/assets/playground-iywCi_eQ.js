import"./modulepreload-polyfill-B5Qt9EMX.js";const u="playgroundDefaults",d={signedReady:!1},e={pactEditor:document.getElementById("pactEditor"),btnLocal:document.getElementById("btnLocal"),divLocalResult:document.getElementById("divLocalResult"),btnSign:document.getElementById("btnSign"),divSigned:document.getElementById("divSigned"),btnSend:document.getElementById("btnSend"),divSendResult:document.getElementById("divSendResult"),btnListen:document.getElementById("btnListen"),btnPoll:document.getElementById("btnPoll"),divTxResult:document.getElementById("divTxResult"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),saveSettings:document.getElementById("saveSettings"),cancelSettings:document.getElementById("cancelSettings"),inputNetwork:document.getElementById("setNetworkId"),inputChain:document.getElementById("setChainId"),inputSender:document.getElementById("setSender"),inputGasLimit:document.getElementById("setGasLimit"),inputGasPrice:document.getElementById("setGasPrice"),inputTTL:document.getElementById("setTtl")};function m(){try{const a=JSON.parse(localStorage.getItem(u)||"null");if(a)return a}catch{}const t={networkId:"testnet04",chainId:"1",sender:"",gasLimit:1e3,gasPrice:1e-8,ttl:28800};return localStorage.setItem(u,JSON.stringify(t)),t}let i=m();function y(){e.inputNetwork.value=i.networkId,e.inputChain.value=i.chainId,e.inputSender.value=i.sender,e.inputGasLimit.value=String(i.gasLimit),e.inputGasPrice.value=String(i.gasPrice),e.inputTTL.value=String(i.ttl),e.settingsModal.style.display="block"}function g(){e.settingsModal.style.display="none"}e.settingsBtn.addEventListener("click",y);e.cancelSettings.addEventListener("click",g);e.saveSettings.addEventListener("click",()=>{i={networkId:e.inputNetwork.value,chainId:e.inputChain.value,sender:e.inputSender.value,gasLimit:Number(e.inputGasLimit.value),gasPrice:Number(e.inputGasPrice.value),ttl:Number(e.inputTTL.value)},localStorage.setItem(u,JSON.stringify(i)),g()});function c(t,a){const n=document.createElement("div");n.style.color="red",n.textContent=JSON.stringify(a),t.innerHTML="",t.appendChild(n)}async function r(t,a){const n=`https://api.testnet.chainweb.com/chainweb/0.0/${i.networkId}/chain/${i.chainId}/pact/api/v1${t}`,s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw await s.json();return await s.json()}e.btnLocal.addEventListener("click",async()=>{const t=e.pactEditor.value,a={sender:i.sender,chainId:i.chainId,gasLimit:i.gasLimit,gasPrice:i.gasPrice,ttl:i.ttl,creationTime:Math.floor(Date.now()/1e3)},n={pactCode:t,envData:{},meta:a,networkId:i.networkId};try{const s=await r("/local",n);e.divLocalResult.textContent=JSON.stringify(s,null,2)}catch(s){c(e.divLocalResult,s)}});e.btnSign.addEventListener("click",async()=>{const t=e.pactEditor.value,a={sender:i.sender,chainId:i.chainId,gasLimit:i.gasLimit,gasPrice:i.gasPrice,ttl:i.ttl,creationTime:Math.floor(Date.now()/1e3)},n={networkId:i.networkId,payload:{exec:{code:t,data:{}}},signers:[{pubKey:i.sender}],meta:a},s=JSON.stringify(n),o=await p(s);try{const l=await window.kadena.requestSign({pactCommand:n});d.cmd=s,d.hash=o,d.sigs=l,d.signedReady=!0,e.btnSend.disabled=!1,e.divSigned.textContent=JSON.stringify({cmd:s,hash:o,sigs:l},null,2)}catch(l){(l==null?void 0:l.type)==="userCancelled"?alert("Signing aborted"):c(e.divSigned,l)}});e.btnSend.addEventListener("click",async()=>{var a;if(!d.signedReady||!d.cmd||!d.hash||!d.sigs)return;const t={cmd:d.cmd,hash:d.hash,sigs:d.sigs};try{const n=await r("/send",t);e.divSendResult.textContent=JSON.stringify(n,null,2);const s=((a=n.requestKeys)==null?void 0:a[0])||n.requestKey;d.requestKey=s,e.btnListen.disabled=!s,e.btnPoll.disabled=!s}catch(n){c(e.divSendResult,n)}});e.btnListen.addEventListener("click",async()=>{if(d.requestKey)try{const t=await r("/listen",{requestKey:d.requestKey});e.divTxResult.textContent=JSON.stringify(t,null,2)}catch(t){c(e.divTxResult,t)}});e.btnPoll.addEventListener("click",async()=>{var a;if(!d.requestKey)return;e.btnPoll.disabled=!0;const t=document.createElement("span");t.textContent="⏳",(a=e.btnPoll.parentElement)==null||a.appendChild(t);try{let n=!1;for(;!n;){const s=await r("/poll",{requestKeys:[d.requestKey]});Object.keys(s).length===0||s[d.requestKey].result.status==="pending"?await new Promise(o=>setTimeout(o,3e3)):(e.divTxResult.textContent=JSON.stringify(s,null,2),n=!0)}}catch(n){c(e.divTxResult,n)}finally{t.remove(),e.btnPoll.disabled=!1}});async function p(t){const a=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t));return Array.from(new Uint8Array(a)).map(n=>n.toString(16).padStart(2,"0")).join("")}
